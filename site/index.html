import sys
from PyQt5.QtWidgets import (
    QApplication, QWidget, QPushButton, QLabel, QVBoxLayout,
    QMessageBox, QLineEdit, QHBoxLayout, QComboBox, QTextEdit
)
from PyQt5.QtGui import QFont

class BankApp(QWidget):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("Banking App")
        self.setGeometry(200, 200, 450, 400)

        self.logged_in = False
        self.balance = 0
        self.history = []

        # Accounts for transfer demo
        self.accounts = {"Me": 0, "Friend": 0, "Family": 0}

        self.dark_mode = False
        self.initUI()

    def initUI(self):
        layout = QVBoxLayout()

        self.label = QLabel("Welcome to Your Bank", self)
        self.label.setFont(QFont("Arial", 14))

        # Login
        self.user_input = QLineEdit()
        self.user_input.setPlaceholderText("Enter username")
        self.pass_input = QLineEdit()
        self.pass_input.setPlaceholderText("Enter password")
        self.pass_input.setEchoMode(QLineEdit.Password)
        self.login_button = QPushButton("Login")
        self.logout_button = QPushButton("Logout")
        self.logout_button.setEnabled(False)

        self.login_button.clicked.connect(self.login)
        self.logout_button.clicked.connect(self.logout)

        # Actions
        self.deposit_button = QPushButton("Deposit Money")
        self.withdraw_button = QPushButton("Withdraw Money")
        self.transfer_button = QPushButton("Transfer Money")
        self.balance_button = QPushButton("Check Balance")
        self.history_button = QPushButton("Transaction History")
        self.reset_button = QPushButton("Reset Account")

        self.deposit_button.clicked.connect(self.deposit)
        self.withdraw_button.clicked.connect(self.withdraw)
        self.transfer_button.clicked.connect(self.transfer)
        self.balance_button.clicked.connect(self.check_balance)
        self.history_button.clicked.connect(self.show_history)
        self.reset_button.clicked.connect(self.reset_account)

        for btn in [self.deposit_button, self.withdraw_button,
                    self.transfer_button, self.balance_button,
                    self.history_button, self.reset_button]:
            btn.setEnabled(False)

        # Dark mode
        self.theme_button = QPushButton("Toggle Light/Dark Mode")
        self.theme_button.clicked.connect(self.toggle_theme)

        # Layout
        layout.addWidget(self.label)
        layout.addWidget(self.user_input)
        layout.addWidget(self.pass_input)

        hlayout = QHBoxLayout()
        hlayout.addWidget(self.login_button)
        hlayout.addWidget(self.logout_button)
        layout.addLayout(hlayout)

        layout.addWidget(self.deposit_button)
        layout.addWidget(self.withdraw_button)
        layout.addWidget(self.transfer_button)
        layout.addWidget(self.balance_button)
        layout.addWidget(self.history_button)
        layout.addWidget(self.reset_button)
        layout.addWidget(self.theme_button)

        self.setLayout(layout)
        self.apply_theme()

    def login(self):
        if self.user_input.text() == "admin" and self.pass_input.text() == "1234":
            self.logged_in = True
            self.label.setText(f"Welcome {self.user_input.text()}!")
            self.toggle_buttons(True)
            self.login_button.setEnabled(False)
            self.logout_button.setEnabled(True)
        else:
            self.show_message("Error", "Invalid username or password!")

    def logout(self):
        self.logged_in = False
        self.label.setText("Welcome to Your Bank")
        self.toggle_buttons(False)
        self.login_button.setEnabled(True)
        self.logout_button.setEnabled(False)

    def toggle_buttons(self, state):
        for btn in [self.deposit_button, self.withdraw_button,
                    self.transfer_button, self.balance_button,
                    self.history_button, self.reset_button]:
            btn.setEnabled(state)

    def deposit(self):
        amount, ok = self.get_amount("Deposit Amount")
        if ok and amount > 0:
            self.balance += amount
            self.accounts["Me"] += amount
            self.history.append(f"Deposited: ₹{amount}")
            self.show_message("Success", f"Deposited ₹{amount}")

    def withdraw(self):
        amount, ok = self.get_amount("Withdraw Amount")
        if ok and 0 < amount <= self.balance:
            self.balance -= amount
            self.accounts["Me"] -= amount
            self.history.append(f"Withdrew: ₹{amount}")
            self.show_message("Success", f"Withdrew ₹{amount}")
        elif ok:
            self.show_message("Error", "Insufficient balance!")

    def transfer(self):
        if not self.logged_in:
            return
        amount, ok = self.get_amount("Enter Transfer Amount")
        if ok and 0 < amount <= self.balance:
            # Pick receiver
            receiver, ok2 = self.get_receiver()
            if ok2:
                self.balance -= amount
                self.accounts["Me"] -= amount
                self.accounts[receiver] += amount
                self.history.append(f"Transferred ₹{amount} to {receiver}")
                self.show_message("Success", f"Transferred ₹{amount} to {receiver}")
        elif ok:
            self.show_message("Error", "Insufficient balance!")

    def check_balance(self):
        self.show_message("Balance", f"Your Balance: ₹{self.balance}")

    def show_history(self):
        history_text = "\n".join(self.history) if self.history else "No transactions yet."
        self.show_message("Transaction History", history_text)

    def reset_account(self):
        self.balance = 0
        self.accounts = {"Me": 0, "Friend": 0, "Family": 0}
        self.history.clear()
        self.show_message("Reset", "Account has been reset.")

    def get_amount(self, title):
        from PyQt5.QtWidgets import QInputDialog
        amount, ok = QInputDialog.getInt(self, title, "Enter amount (₹):", 0, 0)
        return amount, ok

    def get_receiver(self):
        from PyQt5.QtWidgets import QInputDialog
        receiver, ok = QInputDialog.getItem(self, "Transfer", "Select recipient:",
                                            list(self.accounts.keys())[1:], 0, False)
        return receiver, ok

    def toggle_theme(self):
        self.dark_mode = not self.dark_mode
        self.apply_theme()

    def apply_theme(self):
        if self.dark_mode:
            self.setStyleSheet("background-color: #121212; color: white;")
            self.label.setStyleSheet("color: white;")
        else:
            self.setStyleSheet("background-color: white; color: black;")
            self.label.setStyleSheet("color: black;")

    def show_message(self, title, text):
        msg = QMessageBox(self)
        msg.setWindowTitle(title)
        msg.setText(text)
        if self.dark_mode:
            msg.setStyleSheet("QLabel { color: white; } QPushButton { color: black; }")
        msg.exec_()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = BankApp()
    window.show()
    sys.exit(app.exec_())