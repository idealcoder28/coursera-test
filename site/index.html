import sys
from PyQt5.QtWidgets import (
    QApplication, QMainWindow, QWidget, QVBoxLayout, QHBoxLayout,
    QLabel, QLineEdit, QPushButton, QMessageBox, QFrame
)
from PyQt5.QtCore import Qt

class BankingApp(QMainWindow):
    def __init__(self):
        super().__init__()
        self.setWindowTitle("🏦 Secure Banking System")
        self.setGeometry(200, 200, 500, 400)

        # Example account (PIN + balance)
        self.correct_pin = "1234"
        self.balance = 1000
        self.is_dark = False  # light mode default

        # Main container
        self.container = QWidget()
        self.layout = QVBoxLayout(self.container)

        # Initialize login screen
        self.show_login()
        self.apply_theme()

        self.setCentralWidget(self.container)

    # ------------------ LOGIN SCREEN ------------------ #
    def show_login(self):
        self.clear_layout()

        title = QLabel("Welcome to Secure Bank")
        title.setStyleSheet("font-size: 22px; font-weight: bold;")
        title.setAlignment(Qt.AlignCenter)
        self.layout.addWidget(title)

        subtitle = QLabel("Please enter your PIN to continue")
        subtitle.setAlignment(Qt.AlignCenter)
        self.layout.addWidget(subtitle)

        self.pin_input = QLineEdit()
        self.pin_input.setEchoMode(QLineEdit.Password)
        self.pin_input.setPlaceholderText("Enter 4-digit PIN")
        self.pin_input.setMaxLength(4)
        self.layout.addWidget(self.pin_input)

        login_btn = QPushButton("Login")
        login_btn.clicked.connect(self.login)
        self.layout.addWidget(login_btn)

        theme_btn = QPushButton("Toggle Light/Dark Mode")
        theme_btn.clicked.connect(self.toggle_theme)
        self.layout.addWidget(theme_btn)

    def login(self):
        if self.pin_input.text() == self.correct_pin:
            self.show_dashboard()
        else:
            self.show_alert("Error", "Incorrect PIN!", error=True)

    # ------------------ DASHBOARD ------------------ #
    def show_dashboard(self):
        self.clear_layout()

        card = QFrame()
        card.setFrameShape(QFrame.StyledPanel)
        card.setStyleSheet("padding: 15px; border-radius: 10px;")
        card_layout = QVBoxLayout(card)

        self.label = QLabel(f"Welcome, Valued Customer!\nBalance: ${self.balance}")
        self.label.setStyleSheet("font-size: 18px; font-weight: bold;")
        self.label.setAlignment(Qt.AlignCenter)
        card_layout.addWidget(self.label)

        # Deposit input
        deposit_layout = QHBoxLayout()
        self.deposit_input = QLineEdit()
        self.deposit_input.setPlaceholderText("Enter deposit amount")
        deposit_btn = QPushButton("Deposit")
        deposit_btn.clicked.connect(self.deposit)
        deposit_layout.addWidget(self.deposit_input)
        deposit_layout.addWidget(deposit_btn)
        card_layout.addLayout(deposit_layout)

        # Withdraw input
        withdraw_layout = QHBoxLayout()
        self.withdraw_input = QLineEdit()
        self.withdraw_input.setPlaceholderText("Enter withdraw amount")
        withdraw_btn = QPushButton("Withdraw")
        withdraw_btn.clicked.connect(self.withdraw)
        withdraw_layout.addWidget(self.withdraw_input)
        withdraw_layout.addWidget(withdraw_btn)
        card_layout.addLayout(withdraw_layout)

        # Check balance
        balance_btn = QPushButton("Check Balance")
        balance_btn.clicked.connect(self.check_balance)
        card_layout.addWidget(balance_btn)

        # Logout
        logout_btn = QPushButton("Logout")
        logout_btn.clicked.connect(self.logout)
        card_layout.addWidget(logout_btn)

        self.layout.addWidget(card)

        theme_btn = QPushButton("Toggle Light/Dark Mode")
        theme_btn.clicked.connect(self.toggle_theme)
        self.layout.addWidget(theme_btn)

    # ------------------ BANK FUNCTIONS ------------------ #
    def deposit(self):
        try:
            amount = int(self.deposit_input.text())
            if amount > 0:
                self.balance += amount
                self.label.setText(f"Welcome, Valued Customer!\nBalance: ${self.balance}")
                self.show_alert("Deposit", f"Deposited ${amount} successfully!")
                self.deposit_input.clear()
            else:
                self.show_alert("Error", "Enter a positive amount.", error=True)
        except:
            self.show_alert("Error", "Invalid deposit amount.", error=True)

    def withdraw(self):
        try:
            amount = int(self.withdraw_input.text())
            if amount > 0:
                if self.balance >= amount:
                    self.balance -= amount
                    self.label.setText(f"Welcome, Valued Customer!\nBalance: ${self.balance}")
                    self.show_alert("Withdraw", f"Withdrew ${amount} successfully!")
                else:
                    self.show_alert("Error", "Insufficient balance!", error=True)
                self.withdraw_input.clear()
            else:
                self.show_alert("Error", "Enter a positive amount.", error=True)
        except:
            self.show_alert("Error", "Invalid withdraw amount.", error=True)

    def check_balance(self):
        self.show_alert("Balance", f"Your balance is: ${self.balance}")

    def logout(self):
        self.show_login()

    # ------------------ UTILITIES ------------------ #
    def clear_layout(self):
        for i in reversed(range(self.layout.count())):
            widget = self.layout.itemAt(i).widget()
            if widget:
                widget.deleteLater()

    def toggle_theme(self):
        self.is_dark = not self.is_dark
        self.apply_theme()

    def apply_theme(self):
        if self.is_dark:
            self.setStyleSheet("""
                QMainWindow { background-color: #121212; }
                QLabel { color: #ffffff; }
                QPushButton {
                    background-color: #1DB954;
                    color: white;
                    font-size: 14px;
                    border-radius: 6px;
                    padding: 6px;
                }
                QPushButton:hover { background-color: #1ed760; }
                QLineEdit {
                    background: #2c2c2c;
                    color: white;
                    padding: 5px;
                    border-radius: 6px;
                }
            """)
        else:
            self.setStyleSheet("""
                QMainWindow { background-color: #f0f2f5; }
                QLabel { color: #0d1b2a; }
                QPushButton {
                    background-color: #003366;
                    color: white;
                    font-size: 14px;
                    border-radius: 6px;
                    padding: 6px;
                }
                QPushButton:hover { background-color: #0055a5; }
                QLineEdit {
                    background: white;
                    color: black;
                    padding: 5px;
                    border-radius: 6px;
                }
            """)

    def show_alert(self, title, message, error=False):
        msg = QMessageBox(self)
        msg.setWindowTitle(title)
        msg.setText(message)
        if self.is_dark:
            msg.setStyleSheet("""
                QMessageBox { background-color: #2c2c2c; color: white; }
                QLabel { color: white; }
                QPushButton { background-color: #1DB954; color: white; padding: 5px; }
                QPushButton:hover { background-color: #1ed760; }
            """)
        if error:
            msg.setIcon(QMessageBox.Warning)
        else:
            msg.setIcon(QMessageBox.Information)
        msg.exec_()

if __name__ == "__main__":
    app = QApplication(sys.argv)
    window = BankingApp()
    window.show()
    sys.exit(app.exec_())